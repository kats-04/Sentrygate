import{j as e,A as z,m as g}from"./animations-CVxur35w.js";import{r as m}from"./vendor-dbpypOpC.js";import{u as D}from"./useQuery-DjR0J6Gq.js";import{B as d,C as y,a as k}from"./Badge-CuQR1N-9.js";import{f as w,u as L}from"./index-BPDhQj-8.js";import{D as $}from"./DashboardShell-Bzp3PMd2.js";import{i as S,a as E,U as O,M as R,S as q,D as M,j as P,F as B,c as J}from"./icons-BJJ_CL-s.js";const Q=({isOpen:i,onClose:n,onSuccess:s})=>{const[t,o]=m.useState({name:"",email:"",role:"User"}),[v,p]=m.useState(!1),{success:u,error:h}=w(),b=async r=>{r.preventDefault(),p(!0);try{const l=await fetch("http://localhost:5001/api/v1/users/invite",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)}),j=await l.json();if(!l.ok)throw new Error(j.error||"Failed to invite user");u(`Invitation sent to ${t.email}!`),o({name:"",email:"",role:"User"}),s&&s(j.data),n()}catch(l){h(l.message)}finally{p(!1)}};return e.jsx(z,{children:i&&e.jsxs(e.Fragment,{children:[e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-black/50 z-40"}),e.jsx(g.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md glass-effect rounded-lg shadow-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsx("h2",{className:"text-xl font-bold",children:"Invite User"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-smooth",children:e.jsx(E,{size:20})})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2",children:[e.jsx(O,{size:16,className:"inline mr-2"}),"Full Name"]}),e.jsx("input",{type:"text",value:t.name,onChange:r=>o({...t,name:r.target.value}),required:!0,placeholder:"John Doe",className:"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2",children:[e.jsx(R,{size:16,className:"inline mr-2"}),"Email Address"]}),e.jsx("input",{type:"email",value:t.email,onChange:r=>o({...t,email:r.target.value}),required:!0,placeholder:"john@example.com",className:"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold mb-2",children:[e.jsx(q,{size:16,className:"inline mr-2"}),"Role"]}),e.jsxs("select",{value:t.role,onChange:r=>o({...t,role:r.target.value}),className:"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring",children:[e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"TeamLead",children:"Team Lead"}),e.jsx("option",{value:"Admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(d,{type:"submit",variant:"primary",className:"flex-1",isLoading:v,children:"Send Invitation"}),e.jsx(d,{type:"button",variant:"secondary",onClick:n,className:"flex-1",children:"Cancel"})]})]})]})})]})})},Y=()=>{const[i,n]=m.useState(""),[s,t]=m.useState({role:"",status:"",dateFrom:"",dateTo:""}),[o,v]=m.useState(!1),[p,u]=m.useState(!1),{user:h}=L(),{success:b,error:r}=w(),{data:l,isLoading:j,refetch:f}=D({queryKey:["users-search",i,s],queryFn:async()=>{const a=new URLSearchParams;return i&&a.append("q",i),s.role&&a.append("role",s.role),s.status&&a.append("status",s.status),s.dateFrom&&a.append("dateFrom",s.dateFrom),s.dateTo&&a.append("dateTo",s.dateTo),(await fetch(`http://localhost:5001/api/v1/users/search?${a}`,{credentials:"include"})).json()},enabled:i.length>0||Object.values(s).some(a=>a)}),C=a=>{a.preventDefault(),f()},F=()=>{t({role:"",status:"",dateFrom:"",dateTo:""}),n("")},A=async(a,c)=>{try{if(!(await fetch(`http://localhost:5001/api/v1/users/${a}/role`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({role:c})})).ok)throw new Error("Failed to change role");b(`Role updated to ${c}`),f()}catch(x){r(x.message)}},T=()=>{window.open("http://localhost:5001/api/v1/users/export","_blank"),b("Exporting users to CSV...")},N=(h==null?void 0:h.role)==="Admin";return e.jsxs($,{children:[e.jsx(Q,{isOpen:p,onClose:()=>u(!1),onSuccess:()=>f()}),e.jsx(g.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-headline-2 mb-2",children:"User Analytics & Search"}),e.jsx("p",{className:"text-body-small",children:"Search and filter users by various criteria"})]}),N&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{variant:"secondary",onClick:T,children:[e.jsx(M,{size:18,className:"mr-2"}),"Export CSV"]}),e.jsxs(d,{variant:"primary",onClick:()=>u(!0),children:[e.jsx(S,{size:18,className:"mr-2"}),"Invite User"]})]})]})}),e.jsx(y,{variant:"glass",padding:"lg",className:"mb-6",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"text",value:i,onChange:a=>n(a.target.value),placeholder:"Search by name or email...",className:"w-full pl-10 pr-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring"})]}),e.jsxs(d,{type:"button",variant:"secondary",onClick:()=>v(!o),children:[e.jsx(B,{size:20}),"Filters"]}),e.jsx(d,{type:"submit",variant:"primary",children:"Search"})]}),o&&e.jsxs(g.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Role"}),e.jsxs("select",{value:s.role,onChange:a=>t({...s,role:a.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"TeamLead",children:"Team Lead"}),e.jsx("option",{value:"User",children:"User"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Status"}),e.jsxs("select",{value:s.status,onChange:a=>t({...s,status:a.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"archived",children:"Archived"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:s.dateFrom,onChange:a=>t({...s,dateFrom:a.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:s.dateTo,onChange:a=>t({...s,dateTo:a.target.value}),className:"w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus-ring"})]}),e.jsx("div",{className:"md:col-span-4",children:e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:F,children:"Clear Filters"})})]})]})}),j&&e.jsx(y,{variant:"glass",padding:"lg",children:e.jsx("div",{className:"text-center py-8 text-slate-500",children:"Loading..."})}),l&&e.jsxs(y,{variant:"glass",padding:"lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h2",{className:"text-lg font-bold",children:["Search Results (",l.total||0,")"]})}),l.data&&l.data.length>0?e.jsx("div",{className:"space-y-3",children:l.data.map(a=>{var c,x;return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-lg bg-slate-50 dark:bg-slate-800 hover:bg-slate-100 dark:hover:bg-slate-700 transition-smooth",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center font-bold text-primary-600 dark:text-primary-400",children:(x=(c=a.name)==null?void 0:c[0])==null?void 0:x.toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:a.email})]}),e.jsx(k,{variant:a.status==="active"?"success":"warning",children:a.status}),N?e.jsxs("select",{value:a.role,onChange:U=>A(a._id,U.target.value),className:"px-3 py-1 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm font-medium",children:[e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"TeamLead",children:"Team Lead"}),e.jsx("option",{value:"Admin",children:"Admin"})]}):e.jsx(k,{children:a.role})]},a._id)})}):e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(J,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No users found matching your criteria"})]})]})]})};export{Y as default};
