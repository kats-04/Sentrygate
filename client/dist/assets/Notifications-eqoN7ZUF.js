import{j as e}from"./animations-CVxur35w.js";import{r as c}from"./vendor-dbpypOpC.js";import{C as x,B as b}from"./Badge-CuQR1N-9.js";import{S as M}from"./Skeleton-DtGl1t5O.js";import{D as U}from"./DashboardShell-Bzp3PMd2.js";import{f as L,e as f}from"./index-BPDhQj-8.js";import"./icons-BJJ_CL-s.js";var R={};const W=async()=>{try{const a=await navigator.serviceWorker.ready;let i=await a.pushManager.getSubscription();if(i)return i;if(i=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:z(R.REACT_APP_VAPID_PUBLIC_KEY)}),!(await fetch("http://localhost:5001/api/v1/notifications/subscribe",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:i})})).ok)throw new Error("Failed to save subscription");return i}catch(a){throw console.error("Error subscribing to push notifications:",a),a}};function z(a){const i="=".repeat((4-a.length%4)%4),p=(a+i).replace(/-/g,"+").replace(/_/g,"/"),l=window.atob(p),s=new Uint8Array(l.length);for(let n=0;n<l.length;++n)s[n]=l.charCodeAt(n);return s}function V(){var j,k,y,v,w,P;const{notifications:a,loading:i,markAsRead:p,deleteNotification:l}=L(),[s,n]=c.useState(null),[S,m]=c.useState(!0),[o,g]=c.useState(!1),[C,E]=c.useState(!1),[h,u]=c.useState(!1);c.useEffect(()=>{N(),"serviceWorker"in navigator&&"PushManager"in window&&(E(!0),_())},[]);const N=async()=>{try{m(!0);const t=await f.notifications.getPreferences();n(t.data)}catch(t){console.error("Failed to fetch preferences:",t)}finally{m(!1)}},_=async()=>{try{const r=await(await navigator.serviceWorker.ready).pushManager.getSubscription();u(!!r)}catch(t){console.error("Error checking push subscription:",t)}},A=async()=>{if(h)try{const r=await(await navigator.serviceWorker.ready).pushManager.getSubscription();r&&(await r.unsubscribe(),await f.notifications.unsubscribePush(),u(!1))}catch(t){console.error("Error unsubscribing from push:",t)}else await W()&&u(!0)},d=async t=>{try{g(!0),n(t),await f.notifications.updatePreferences(t)}catch(r){console.error("Failed to update preferences:",r),N()}finally{g(!1)}};if(i||S)return e.jsx(M,{count:5});const D={info:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",success:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",warning:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",error:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",alert:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200"};return e.jsx(U,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-slate-900 dark:text-slate-50 mb-2",children:"Notifications"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Manage your alerts and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-50",children:"Recent Notifications"}),a.length===0?e.jsx(x,{className:"glass-effect p-6 text-center",children:e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No notifications"})}):a.map(t=>e.jsx(x,{className:`glass-effect p-4 cursor-pointer hover:shadow-lg transition ${t.read?"":"border-l-4 border-blue-500"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${D[t.type]}`,children:t.type.toUpperCase()}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50 mt-2",children:t.title}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:t.message}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:new Date(t.createdAt).toLocaleString()})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[!t.read&&e.jsx(b,{size:"sm",onClick:()=>p(t._id),className:"bg-blue-600 hover:bg-blue-700",children:"Read"}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>l(t._id),className:"text-red-600 hover:bg-red-100 dark:hover:bg-red-900",children:"Delete"})]})]})},t._id))]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-50 mb-4",children:"Preferences"}),s&&e.jsxs(x,{className:"glass-effect p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:(j=s.emailNotifications)==null?void 0:j.enabled,onChange:t=>d({...s,emailNotifications:{...s.emailNotifications,enabled:t.target.checked}}),disabled:o,className:"w-4 h-4"}),e.jsx("span",{className:"text-slate-900 dark:text-slate-50 font-semibold",children:"Email Notifications"})]}),((k=s.emailNotifications)==null?void 0:k.enabled)&&e.jsxs("select",{value:((y=s.emailNotifications)==null?void 0:y.frequency)||"daily",onChange:t=>d({...s,emailNotifications:{...s.emailNotifications,frequency:t.target.value}}),disabled:o,className:"mt-2 w-full p-2 rounded bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-50",children:[e.jsx("option",{value:"instant",children:"Instant"}),e.jsx("option",{value:"daily",children:"Daily Digest"}),e.jsx("option",{value:"weekly",children:"Weekly Digest"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:(v=s.pushNotifications)==null?void 0:v.enabled,onChange:t=>d({...s,pushNotifications:{...s.pushNotifications,enabled:t.target.checked}}),disabled:o,className:"w-4 h-4"}),e.jsx("span",{className:"text-slate-900 dark:text-slate-50 font-semibold",children:"Push Notifications"})]}),((w=s.pushNotifications)==null?void 0:w.enabled)&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",checked:(P=s.pushNotifications)==null?void 0:P.soundEnabled,onChange:t=>d({...s,pushNotifications:{...s.pushNotifications,soundEnabled:t.target.checked}}),disabled:o,className:"w-4 h-4"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300 text-sm",children:"Enable Sound"})]}),C&&e.jsx(b,{size:"sm",onClick:A,className:"mt-2 w-full",variant:h?"destructive":"default",children:h?"Unsubscribe from Push":"Subscribe to Push"})]})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-50 mb-2",children:"Notification Types"}),e.jsx("div",{className:"space-y-2",children:Object.entries(s.notificationTypes||{}).map(([t,r])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:T=>d({...s,notificationTypes:{...s.notificationTypes,[t]:T.target.checked}}),disabled:o,className:"w-4 h-4"}),e.jsx("span",{className:"text-slate-700 dark:text-slate-300 text-sm capitalize",children:t.replace(/([A-Z])/g," $1")})]},t))})]})]})]})]})]})})}export{V as default};
