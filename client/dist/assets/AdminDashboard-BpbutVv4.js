import{j as e,m as w}from"./animations-CVxur35w.js";import{r as l}from"./vendor-dbpypOpC.js";import{e as u,v as A}from"./index-BPDhQj-8.js";import{D as S,z as c}from"./DashboardShell-Bzp3PMd2.js";import{p as N,c as F,q as v,L as C,r as L,d as M}from"./icons-BJJ_CL-s.js";import"./Badge-CuQR1N-9.js";const T=()=>{const[r,m]=l.useState({allowRegistrations:!0,maintenanceMode:!1,sessionTimeout:60,enforceMFA:!1}),[f,d]=l.useState(!0);l.useEffect(()=>{o()},[]);const o=async()=>{try{const s=await u.get("/admin/settings");m(s)}catch(s){console.error("Failed to fetch settings",s)}finally{d(!1)}},x=s=>{const{name:n,value:h,type:g,checked:j}=s.target;m(y=>({...y,[n]:g==="checkbox"?j:Number(h)}))},p=async()=>{try{await u.patch("/admin/settings",r),c.success("System settings updated")}catch{c.error("Failed to update settings")}};return f?e.jsx("div",{children:"Loading settings..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(N,{size:20})," System Configuration"]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Allow Registrations"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Enable or disable new user signups"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"allowRegistrations",checked:r.allowRegistrations,onChange:x,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Maintenance Mode"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Restrict access to Admins only"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"maintenanceMode",checked:r.maintenanceMode,onChange:x,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-error-300 dark:peer-focus:ring-error-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-error-600"})]})]})]})]}),e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{size:20})," Security Policies"]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Session Timeout (minutes)"}),e.jsx("input",{type:"number",name:"sessionTimeout",value:r.sessionTimeout,onChange:x,className:"input-field max-w-xs",min:"5",max:"1440"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Enforce MFA"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Require Two-Factor Authentication for all users"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"enforceMFA",checked:r.enforceMFA,onChange:x,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:p,className:"btn-primary flex items-center gap-2",children:[e.jsx(L,{size:18})," Save Changes"]})})]})},R=()=>{const[r,m]=l.useState([]),[f,d]=l.useState(!0),[o,x]=l.useState(1),[p,s]=l.useState(1),[n,h]=l.useState([]);l.useEffect(()=>{g();const t=A("http://localhost:5001",{withCredentials:!0});return t.emit("join-admin-room"),t.on("user-updated",a=>{m(i=>i.map(b=>b._id===a.userId?{...b,...a}:b))}),t.on("admin-action",a=>{h(i=>[a,...i].slice(0,50))}),()=>{t.disconnect()}},[o]);const g=async()=>{var t;try{d(!0);const i=(await u.get(`/users?page=${o}&limit=10`)).data||{},b=Array.isArray(i)?i:i.data||[];m(Array.isArray(b)?b:[]),s(((t=i.pagination)==null?void 0:t.pages)||1)}catch(a){console.error("Failed to fetch users:",a),c.error("Failed to fetch users"),m([])}finally{d(!1)}},j=async(t,a)=>{try{await u.users.changeRole(t,a),c.success(`Role updated to ${a}`)}catch{c.error("Failed to update role")}},y=async(t,a)=>{const i=a==="active"?"suspended":"active";if(!(i==="suspended"&&!window.confirm("Are you sure you want to suspend this user? This will invalidate their current session immediately.")))try{await u.users.updateStatus(t,i),c.success(`User ${i}`)}catch{c.error("Failed to update status")}},k=async t=>{if(window.confirm("Are you sure you want to reset MFA for this user?"))try{await u.post(`/users/${t}/reset-mfa`),c.success("MFA reset successfully")}catch{c.error("Failed to reset MFA")}};return f?e.jsx("div",{children:"Loading users..."}):e.jsxs("div",{className:"glass-panel p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"User Management"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"pb-3 pl-2",children:"User"}),e.jsx("th",{className:"pb-3",children:"Role"}),e.jsx("th",{className:"pb-3",children:"Status"}),e.jsx("th",{className:"pb-3 text-right pr-2",children:"Actions"})]})}),e.jsx("tbody",{children:r.map(t=>e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-800 last:border-0 hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsxs("td",{className:"py-3 pl-2",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-xs text-slate-500",children:t.email})]}),e.jsx("td",{className:"py-3",children:e.jsxs("select",{value:t.role,onChange:a=>j(t._id,a.target.value),className:`text-xs px-2 py-1 rounded-full font-medium border-0 cursor-pointer focus:ring-2 focus:ring-primary-500 ${t.role==="Admin"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":t.role==="TeamLead"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300"}`,children:[e.jsx("option",{value:"User",children:"User"}),e.jsx("option",{value:"TeamLead",children:"TeamLead"}),e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Auditor",children:"Auditor"})]})}),e.jsx("td",{className:"py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${t.status==="active"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"}`,children:t.status})}),e.jsxs("td",{className:"py-3 text-right pr-2 space-x-2",children:[e.jsx("button",{onClick:()=>k(t._id),className:"text-xs bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 px-2 py-1 rounded text-slate-700 dark:text-slate-300",title:"Reset MFA",children:"Reset MFA"}),t.role!=="Admin"&&e.jsx("button",{onClick:()=>y(t._id,t.status),className:`text-xs px-3 py-1 rounded font-medium transition-colors ${t.status==="active"?"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 dark:bg-red-900/10 dark:hover:bg-red-900/20 dark:border-red-800":"bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 dark:bg-emerald-900/10 dark:hover:bg-emerald-900/20 dark:border-emerald-800"}`,children:t.status==="active"?"Suspend":"Activate"})]})]},t._id))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{onClick:()=>x(t=>Math.max(1,t-1)),disabled:o===1,className:"text-sm text-slate-500 disabled:opacity-50 hover:text-slate-700",children:"Previous"}),e.jsxs("span",{className:"text-sm text-slate-500",children:["Page ",o," of ",p]}),e.jsx("button",{onClick:()=>x(t=>Math.min(p,t+1)),disabled:o===p,className:"text-sm text-slate-500 disabled:opacity-50 hover:text-slate-700",children:"Next"})]}),e.jsxs("div",{className:"mt-8 border-t border-slate-200 dark:border-slate-700 pt-6",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-500 mb-3 flex items-center gap-2",children:[e.jsx(M,{size:16})," Live Admin Activity"]}),e.jsx("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-lg p-4 max-h-48 overflow-y-auto space-y-2",children:n.length>0?n.map((t,a)=>e.jsxs("div",{className:"text-xs flex items-center justify-between text-slate-600 dark:text-slate-400",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-200",children:t.adminName})," ",t.details]}),e.jsx("span",{className:"text-slate-400",children:new Date(t.timestamp).toLocaleTimeString()})]},a)):e.jsx("div",{className:"text-xs text-slate-400 text-center py-4",children:"No recent admin activity. Try changing a user's role or status to see live updates here."})})]})]})},U=()=>{const[r,m]=l.useState([]),[f,d]=l.useState(!0),[o]=l.useState("all");l.useEffect(()=>{x()},[o]);const x=async()=>{try{const s=o!=="all"?`&type=${o}`:"",n=await u.get(`/security/audit?limit=20${s}`);m(Array.isArray(n)?n:n.data||[])}catch{c.error("Failed to fetch audit logs")}finally{d(!1)}},p=async()=>{try{const s=await u.get("/security/audit/export",{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([s.data])),h=document.createElement("a");h.href=n,h.setAttribute("download",`audit-log-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(h),h.click(),h.remove(),c.success("Audit log downloaded")}catch{c.error("Failed to export logs")}};return e.jsxs("div",{className:"glass-panel p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(v,{size:20})," Audit Trail"]}),e.jsx("button",{type:"button",onClick:p,className:"btn-secondary text-sm flex items-center gap-2",children:"Download CSV"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"pb-3 text-slate-500",children:"Time"}),e.jsx("th",{className:"pb-3 text-slate-500",children:"User"}),e.jsx("th",{className:"pb-3 text-slate-500",children:"Action"}),e.jsx("th",{className:"pb-3 text-slate-500",children:"IP Address"}),e.jsx("th",{className:"pb-3 text-slate-500",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-800",children:r.map(s=>{var n;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"py-2 text-slate-500",children:new Date(s.createdAt).toLocaleString()}),e.jsx("td",{className:"py-2 font-medium",children:((n=s.userId)==null?void 0:n.name)||"Unknown"}),e.jsx("td",{className:"py-2",children:s.type||"LOGIN"}),e.jsx("td",{className:"py-2 text-mono text-xs",children:s.ipAddress}),e.jsx("td",{className:"py-2",children:e.jsx("span",{className:`xs-badge ${s.success?"bg-green-100 text-green-700 dark:bg-green-900/30":"bg-red-100 text-red-700 dark:bg-red-900/30"}`,children:s.success?"Success":"Failed"})})]},s._id)})})]})})]})},I=()=>{const[r,m]=l.useState("general"),f=[{id:"general",label:"General",icon:N},{id:"users",label:"Users",icon:F},{id:"audit",label:"Audit Logs",icon:v}];return e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent",children:"Admin Control Panel"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Manage system configuration and security."})]}),e.jsx("div",{className:"flex gap-4 border-b border-slate-200 dark:border-slate-700 overflow-x-auto pb-1",children:f.map(d=>e.jsxs("button",{onClick:()=>m(d.id),className:`
              flex items-center gap-2 px-4 py-2 font-medium transition-colors whitespace-nowrap
              ${r===d.id?"text-primary-600 border-b-2 border-primary-600":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}
            `,children:[e.jsx(d.icon,{size:18}),d.label]},d.id))}),e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},children:[r==="general"&&e.jsx(T,{}),r==="users"&&e.jsx(R,{}),r==="audit"&&e.jsx(U,{})]},r)]})})};export{I as default};
